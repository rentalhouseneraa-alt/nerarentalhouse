{% extends "base.html" %}
{% block title %}Orders{% endblock %}
{% block content %}

<div class="container-fluid px-2 px-md-4">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-3">
    <h3 class="mb-3 mb-md-0 text-center text-md-start">Manage Orders</h3>

    <div class="d-flex flex-column flex-sm-row align-items-stretch align-items-sm-center justify-content-center justify-content-md-end w-100 w-md-auto gap-2">
      <form class="d-flex flex-grow-1 flex-sm-row flex-wrap gap-2" method="get" action="{{ url_for('main.admin_orders') }}">
        <div class="flex-grow-1">
          <input class="form-control" type="search" name="q"
                 placeholder="Search customer / product / staff / date"
                 value="{{ request.args.get('q','') }}">
        </div>
        <button class="btn btn-outline-primary px-3" type="submit">Search</button>
      </form>
      <div class="d-flex flex-sm-row flex-wrap justify-content-center gap-2">
        <a href="{{ url_for('main.admin_staffs') }}" class="btn btn-outline-secondary px-3">Staffs</a>
        <a href="{{ url_for('main.admin_reports') }}" class="btn btn-success px-3">Reports</a>
      </div>
    </div>
  </div>

  <div class="table-responsive shadow-sm rounded">
    <table class="table table-striped table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>Created</th>
          <th>Staff</th>
          <th>Customer</th>
          <th>Product</th>
          <th>Total</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td>{{ order.id }}</td>
          <td>{{ order.created_at.strftime('%Y-%m-%d %H:%M') if order.created_at else '-' }}</td>
          <td>{{ order.staff.full_name if order.staff and order.staff.full_name else (order.staff.username if order.staff else '-') }}</td>
          <td>{{ order.customer.name if order.customer else '-' }}</td>
          <td>{{ order.product_name }}</td>
          <td>â‚¹{{ "%.2f"|format(order.total_amount or (order.price * order.quantity)) }}</td>
          <td>
            {% if order.status == 'canceled' %}
              <span class="badge bg-danger">Canceled</span>
            {% elif order.status == 'completed' %}
              <span class="badge bg-success">Completed</span>
            {% elif order.status == 'approved' %}
              <span class="badge bg-info">Approved</span>
            {% else %}
              <span class="badge bg-warning text-dark">{{ order.status }}</span>
            {% endif %}
          </td>
          <td class="text-nowrap">
            <a class="btn btn-sm btn-primary me-1 mb-1" href="{{ url_for('main.admin_edit_order', order_id=order.id) }}">Edit</a>
            <a class="btn btn-sm btn-secondary mb-1" href="{{ url_for('main.admin_bill', order_id=order.id) }}" target="_blank">Bill</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
